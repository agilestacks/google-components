version: 1
kind: component

requires:
  - terraform

parameters:
  - name: dns.name
  - name: hub.componentName
  - name: gke.nodeCount
    value: 3
    env: TF_VAR_node_count
  - name: gke.machineType
    value: "n1-standard-1"
    env: TF_VAR_node_machine_type
  - name: component.network.subnetwork
    env: TF_VAR_subnetwork
  - name: composer.envName
    value: ${dns.name}-${hub.componentName}
  - name: composer.version
    value: v1
    env: TF_VAR_composer_version

outputs:
  - name: composer.airflow.url
    fromTfVar: airflow_uri
  - name: composer.gcs.bucket
    fromTfVar: gcs_bucket
  - name: composer.gke.cluster
    fromTfVar: gke_cluster
  - name: composer.gke.kubeconfig
    fromTfVar: kubeconfig

templates:
  files: ["*.template"]
